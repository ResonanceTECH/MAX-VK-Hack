# MAX-VK-Hack - Цифровая образовательная платформа

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![Python](https://img.shields.io/badge/Python-3.11-3776ab.svg)
![React](https://img.shields.io/badge/React-18.2.0-61dafb.svg)
![TypeScript](https://img.shields.io/badge/TypeScript-5.3.3-3178c6.svg)

**Цифровая образовательная платформа для студентов, преподавателей и сотрудников ВУЗа**

Объединяет чат-бота в мессенджере MAX и веб-миниприложение для управления образовательным процессом.

##  Оглавление

- [Описание проекта](#описание-проекта)
- [Архитектура системы](#архитектура-системы)
- [Функционал чат-бота](#функционал-чат-бота)
- [Функционал миниприложения](#функционал-миниприложения)
- [Фичи](#фичи)
- [Технологический стек](#технологический-стек)
- [Запуск проекта](#запуск-проекта)
- [Конфигурация](#конфигурация)
- [Структура проекта](#структура-проекта)

##  Описание проекта

Цифровая образовательная платформа MAX объединяет студентов, преподавателей и администрацию в едином цифровом пространстве. Система обеспечивает:

- **Прозрачность коммуникаций** - обмен сообщениями между всеми участниками образовательного процесса
- **Удобный доступ к расписанию** - просмотр расписания занятий
- **Управление группами** - просмотр информации о группах, студентах и преподавателях
- **Новостная лента** - актуальные новости и анонсы
- **Система поддержки** - обработка запросов в поддержку с отслеживанием статистики
- **Административная панель** - полное управление студентами, преподавателями, группами и новостями

##  Архитектура системы

Проект состоит из следующих компонентов:

```
┌─────────────────────────────────────────────────────────┐
│                      Caddy (Reverse Proxy)              │
│              HTTPS, SSL, Routing, Load Balancing        │
└──────────────┬──────────────────────────────────────────┘
               │
    ┌──────────┴────────┬──────────────┬──────────────┐
    │                   │              │              │
┌───▼────┐  ┌───────────▼──┐  ┌────────▼──┐  ┌────────▼──┐
│Frontend│  │   Backend    │  │ Schedule  │  │     Bot   │
│ React  │  │   FastAPI    │  │  FastAPI  │  │   Python  │
│  :3000 │  │    :8000     │  │   :8001   │  │  Polling  │
└────────┘  └──────────────┘  └───────────┘  └───────────┘
               │                      │              │
               └──────────────────────┴──────────────┘
                            │
                    ┌───────▼───────┐
                    │  PostgreSQL   │
                    │     :5432     │
                    └───────────────┘
```

### Компоненты:

1. **Caddy** - Reverse proxy с автоматическим HTTPS, маршрутизация запросов
2. **Frontend** - React-приложение для веб-интерфейса
3. **Backend** - FastAPI сервер для REST API миниприложения
4. **Schedule** - FastAPI сервис для парсинга расписания
5. **Bot** - Python-бот для мессенджера MAX
6. **PostgreSQL** - База данных для хранения всех данных

## Функционал чат-бота

Чат-бот в мессенджере MAX предоставляет интерфейс для всех ролей пользователей.

### Роли пользователей

#### Студент

- **Моя группа**
  - Просмотр информации о своей группе
  - Список одногруппников
  - Возможность написать сокурснику через бота
  
- **Преподаватели**
  - Список всех преподавателей
  - Контакты преподавателей (телефон, email)
  - Возможность написать преподавателю через бота от своего лица, а также от лица группы (если староста)
  
- **Расписание**
  - Расписание на сегодня
  - Расписание на неделю
  
- **Новости**
  - Просмотр актуальных новостей и анонсов
  
- **Помощь**
  - FAQ с часто задаваемыми вопросами
  - Связь с поддержкой

#### Преподаватель

- **Мои группы**
  - Список групп, которые ведет преподаватель
  - Просмотр студентов в каждой группе
  - Информация о старостах
  - Возможность написать студентам через бота
  - Возможность сделать рассылку всей группе
  
- **Старосты**
  - Список всех старост
  - Контакты старост
  - Возможность написать старостам через бота
  - Возможность сделать рассылку всем старостам
  
- **Преподаватели**
  - Список всех преподавателей
  - Контакты преподавателей
  - Возможность написать преподавателям через бота
  
- **Расписание**
  - Расписание на сегодня
  - Расписание на неделю
  
- **Новости**
  - Просмотр новостей
  
- **Помощь**
  - FAQ и связь с поддержкой

#### Администратор

- **Редактирование расписания**
  - Возможность редактирования расписания для использования бота разными вузами
  
- **Рассылки**
  - Отправка сообщений группам студентов
  - Отправка сообщений преподавателям
  
- **Отчеты**
  - Статистика по системе
  
- **Новости**
  - Создание и публикация новостей
  
- **Поддержка**
  - Просмотр запросов в поддержку
  - Управление обращениями

#### Поддержка

- **Запросы в поддержку**
  - Просмотр новых обращений
  - Просмотр обращений в работе
  - Просмотр решенных обращений
  - Изменение статусов обращений
  - Ответы на обращения
  
- **Статистика**
  - Метрики по обращениям
  - Аналитика работы поддержки

### Команды бота

- `/start` - Запуск бота, показ главного меню
- `/help` - Показ справки по использованию бота

### Особенности

- **Многоролевая система** - пользователь может иметь несколько ролей одновременно (например, студент и преподаватель)
- **Выбор роли** - если у пользователя несколько ролей, он может переключаться между ними
- **Верификация пользователей** - доступ к боту только для зарегистрированных пользователей
- **Интеграция с расписанием** - получение данных из внешнего API расписания
- **Логирование действий** - все действия пользователей логируются для аналитики

## Функционал миниприложения

Веб-миниприложение предоставляет расширенный функционал для управления образовательным процессом.

### Роли пользователей

#### Студент

**Страницы:**
- **Сообщения** (`/messages`)
  - Просмотр входящих и исходящих сообщений
  - Фильтрация по статусу (прочитано/не прочитано)
  - Фильтрация по группе
  
- **Моя группа** (`/my-group`)
  - Информация о группе
  - Список одногруппников
  - Контакты одногруппников (копирование телефонов и email)
  
- **Расписание** (`/schedule`)
  - Просмотр расписания занятий
  
- **Преподаватели** (`/teachers`)
  - Список всех преподавателей
  - Контакты преподавателей
  - Копирование контактов
  
- **Новости** (`/news`)
  - Просмотр актуальных новостей
  - Фильтрация новостей

#### Преподаватель

**Страницы:**
- **Сообщения** (`/messages`)
  - Просмотр сообщений
  - Фильтрация сообщений
  
- **Мои группы** (`/my-groups`)
  - Список групп, которые ведет преподаватель
  - Просмотр студентов в каждой группе
  - Контакты студентов
  
- **Расписание** (`/schedule`)
  - Просмотр расписания
  
- **Преподаватели** (`/teachers`)
  - Список преподавателей
  - Контакты
  
- **Новости** (`/news`)
  - Просмотр новостей

#### Администратор

**Страницы:**
- **Управление студентами** (`/admin/students`)
  - Просмотр списка студентов
  - Добавление нового студента
  - Редактирование студента
  - Удаление студента
  - Назначение старосты
  - Поиск студентов
  
- **Управление преподавателями** (`/admin/teachers`)
  - Просмотр списка преподавателей
  - Добавление нового преподавателя
  - Редактирование преподавателя
  - Удаление преподавателя
  - Поиск преподавателей
  
- **Управление группами** (`/admin/groups`)
  - Просмотр списка групп
  - Добавление новой группы
  - Редактирование группы
  - Удаление группы
  - Назначение студентов в группу
  - Назначение преподавателей на группу
  
- **Новости** (`/admin/news`)
  - Создание новости
  - Редактирование новости
  - Публикация/снятие с публикации
  - Удаление новости
  
- **Сообщения** (`/messages`)
  - Просмотр всех сообщений в системе
  - Фильтрация сообщений

#### Поддержка

**Страницы:**
- **Запросы в поддержку** (`/support-tickets`)
  - Просмотр новых обращений
  - Просмотр обращений в работе
  - Просмотр решенных обращений
  - Изменение статусов обращений
  - Ответы на обращения
  
- **Статистика** (`/stats`)
  - Дашборд с метриками обращений
  - Графики и аналитика
  
- **Сообщения** (`/messages`)
  - Просмотр сообщений поддержки

### Особенности интерфейса

- **Адаптивный дизайн** - Mobile-first подход, работает на всех устройствах
- **Единая дизайн-система** - CSS переменные для цветов, теней, скруглений
- **Современный UI** - Карточный интерфейс с градиентами и анимациями
- **Иконки HugeIcons** - Современные SVG-иконки во всех компонентах
- **Выбор роли в header** - Переключение между ролями прямо в навигации
- **Фильтрация** - Удобные фильтры для сообщений, новостей, студентов
- **Копирование контактов** - Быстрое копирование телефонов и email одним кликом
- **Статистика** - Визуализация данных для поддержки и администрации

## Фичи

### Чат-бот

#### Коммуникации
- **Система сообщений** - Обмен сообщениями между студентами, преподавателями и администрацией
- **Сохранение сообщений** - Все сообщения сохраняются в БД, доставляются даже если получатель еще не заходил в бота
- **Рассылки** - Массовая отправка сообщений группам студентов, старостам, всем студентам/преподавателям
- **Сообщения от группы** - Старосты могут отправлять сообщения преподавателям от имени группы

#### Расписание
- **Расписание на сегодня** - Быстрый просмотр занятий на текущий день
- **Расписание на неделю** - Полное расписание через миниприложение
- **Интеграция с внешним API** - Гибкая настройка URL API расписания для разных вузов
- **Автоматическое определение** - Для студентов по группе, для преподавателей по ФИО

#### Управление
- **Многоролевая система** - Один пользователь может быть студентом, преподавателем и администратором одновременно
- **Переключение ролей** - Удобное переключение между ролями прямо в боте
- **Верификация пользователей** - Доступ только для зарегистрированных пользователей
- **Назначение старост** - Администраторы могут назначать старост в группах

#### Административные функции
- **Управление расписанием** - Настройка URL API расписания через бота
- **Рассылки администрации** - Массовые уведомления студентам и преподавателям
- **Управление поддержкой** - Просмотр и обработка обращений в поддержку
- **Статистика** - Отчеты по системе

#### Система поддержки
- **Автоматическое создание тикетов** - При отправке сообщения в поддержку создается тикет
- **Управление статусами** - Изменение статусов обращений (новое, в работе, решено)
- **Ответы на обращения** - Прямая отправка ответов пользователям из тикетов
- **Статистика обращений** - Метрики и аналитика для поддержки

### Миниприложение

#### Интерфейс
- **Адаптивный дизайн** - Mobile-first подход, корректная работа на всех устройствах
- **Единая дизайн-система** - CSS переменные для цветов, теней, скруглений, легкая кастомизация
- **Карточный интерфейс** - Современный UI с карточками вместо таблиц
- **Градиенты и анимации** - Плавные переходы и hover-эффекты для улучшения UX
- **Иконки HugeIcons** - Современные SVG-иконки во всех компонентах

#### Функциональность
- **Выбор роли в header** - Переключение между ролями прямо в навигации без перезагрузки
- **Фильтрация сообщений** - Фильтры по статусу (прочитано/не прочитано), группе, роли
- **Копирование контактов** - Быстрое копирование телефонов и email одним кликом
- **Поиск** - Поиск студентов, преподавателей, групп в административной панели
- **Статистика поддержки** - Дашборд с метриками обращений, графики и аналитика

#### Административная панель
- **CRUD операции** - Полное управление студентами, преподавателями, группами
- **Управление новостями** - Создание, редактирование, публикация/снятие с публикации новостей
- **Назначение в группы** - Добавление студентов в группы, назначение преподавателей на группы
- **Просмотр всех сообщений** - Администраторы видят все сообщения в системе с фильтрацией

#### Технические особенности
- **Модульная архитектура** - Переиспользуемые React компоненты
- **TypeScript** - Полная типизация для надежности кода
- **RESTful API** - Стандартизированные API endpoints
- **Авторизация через initData** - Безопасная авторизация через MAX Web App
- **Логирование действий** - Все действия пользователей логируются для аналитики

### Общие фичи

- **Двухканальная работа** - Чат-бот для быстрых действий, миниприложение для расширенного функционала
- **Синхронизация данных** - Единая база данных для бота и миниприложения
- **Docker-контейнеризация** - Легкое развертывание всех компонентов
- **Автоматический HTTPS** - Caddy автоматически получает SSL сертификаты
- **Swagger документация** - Полная API документация доступна по `/api/docs`

## Технологический стек

### Backend

- **Python 3.11** - Основной язык программирования
- **FastAPI** - Веб-фреймворк для API
- **PostgreSQL 15** - Реляционная база данных
- **asyncpg** - Асинхронный драйвер для PostgreSQL
- **httpx** - HTTP клиент для внешних API
- **MaxAPI** - Интеграция с API мессенджера MAX

### Frontend

- **React 18.2** с TypeScript 5.3
- **React Router 6** - Маршрутизация
- **Vite 5** - Сборщик
- **Axios** - HTTP-запросы
- **Lucide React** - Базовые иконки
- **CSS Modules** - Стилизация

### Infrastructure

- **Docker** - Контейнеризация
- **Docker Compose** - Оркестрация контейнеров
- **Caddy 2** - Reverse proxy с автоматическим HTTPS

## Запуск проекта

### Предварительные требования

- Docker и Docker Compose
- Git
- (Опционально) Python 3.11+ для локальной разработки

### Локальная разработка

#### 1. Клонирование репозитория

```bash
git clone https://github.com/ResonanceTECH/MAX-VK-Hack.git
cd MAX-VK-Hack
```

#### 2. Настройка переменных окружения

Создайте файл `.env` в корневой директории и в директории miniapp:

```env
# Токен бота MAX
MAX_BOT_TOKEN=<Токен, который Вы нам прислали>

# Опционально, есть значения по умолчанию
POSTGRES_PORT=5432
POSTGRES_USER=maxbot
POSTGRES_PASSWORD=maxbot123
POSTGRES_DB=maxbot_db
SKIP_AUTH=true
SKIP_INITDATA_VERIFY=true
DEV_USER_MAX_ID=96855100
```

#### 3. Запуск всех сервисов

**Локальный запуск всех сервисов**

```bash
cd miniapp
docker compose up --build
```

#### 4. Доступ к сервисам

После запуска сервисы будут доступны:

- **Frontend**: `https://localhost` (через Caddy)
- **Backend API**: `https://localhost/api`
- **Schedule API**: `https://localhost/api2`
- **PostgreSQL**: `localhost:5433` (для внешнего доступа)
- **Swagger документация**: `https://localhost/api/docs`

## -----------------------------------------------------------------------------------------------
# Внимание! Если у Вас следующее сообщение при первом заходе в бота:

Добро пожаловать в Цифровой университет.

❌ Вы не зарегистрированы в системе. Обратитесь к администрации.

## Введите еще раз /start
## -----------------------------------------------------------------------------------------------

### Production развертывание

#### 1. Настройка для production

Используйте `docker-compose.yml` в корневой директории с `Caddyfile.production`:

```bash
# В docker-compose.yml уже указан Caddyfile.production
docker compose up -d --build
```
(Это то, как мы хостили приложение.)

#### 2. Настройка домена

Для production мы использовали домен через `nip.io`:

- **nip.io**: `178.72.139.15.nip.io` (автоматически резолвится в IP)
- Caddy автоматически получит SSL сертификат от Let's Encrypt

#### 3. Переменные окружения для production

Установите переменные окружения на хосте:

```env
MAX_BOT_TOKEN=<Токен, который Вы нам прислали>

POSTGRES_PORT=5432
POSTGRES_USER=maxbot
POSTGRES_PASSWORD=maxbot123
POSTGRES_DB=maxbot_db
SKIP_AUTH=true
SKIP_INITDATA_VERIFY=true
DEV_USER_MAX_ID=96855100
```

#### 4. Запуск

```bash
docker compose up -d --build
```

## Конфигурация

### Caddyfile

- **Локальная разработка**: `miniapp/caddy/Caddyfile`
- **Production**: `miniapp/caddy/Caddyfile.production`

Caddy автоматически:
- Получает SSL сертификаты от Let's Encrypt
- Перенаправляет HTTP на HTTPS
- Маршрутизирует запросы:
  - `/api/*` → Backend (8000)
  - `/api2/*` → Schedule (8001)
  - `/*` → Frontend (3000)

## Структура проекта

```
MAX-VK-Hack/
├── api/                      # API клиент для MAX
│   └── max_api.py
├── bot.py                    # Главный файл бота
├── config.py                 # Конфигурация бота
├── docker-compose.yml        # Docker Compose для production
├── Dockerfile                # Dockerfile для бота
├── handlers/                 # Обработчики событий бота
│   ├── admin_handler.py      # Обработчики для администраторов
│   ├── base.py              # Базовый класс обработчика
│   ├── bot_started.py       # Обработчик запуска бота
│   ├── callback.py         # Обработчик callback кнопок
│   ├── common_handler.py    # Общие обработчики
│   ├── message.py           # Обработчик сообщений
│   ├── schedule_handler.py  # Обработчик расписания
│   ├── student_handler.py   # Обработчики для студентов
│   ├── support_handler.py  # Обработчики для поддержки
│   └── teacher_handler.py   # Обработчики для преподавателей
├── db/                      # Работа с базой данных
│   ├── connection.py       # Подключение к БД
│   ├── init_db.py           # Инициализация БД
│   ├── models.py            # Модели данных
│   └── schema.sql           # SQL схема БД
├── miniapp/                 # Миниприложение
│   ├── backend/             # Backend API
│   │   ├── api/
│   │   │   ├── auth.py      # Авторизация
│   │   │   └── routes.py    # API маршруты
│   │   ├── main.py          # Точка входа FastAPI
│   │   └── Dockerfile
│   ├── caddy/               # Конфигурация Caddy
│   │   ├── Caddyfile        # Локальная разработка
│   │   ├── Caddyfile.production  # Production
│   │   └── ssl/             # SSL сертификаты
│   ├── docker-compose.yml    # Docker Compose для локальной разработки
│   └── frontend/             # Frontend React приложение
│       ├── src/
│       │   ├── components/   # React компоненты
│       │   ├── pages/        # Страницы приложения
│       │   ├── hooks/        # React хуки
│       │   └── utils/        # Утилиты
│       └── Dockerfile
├── shedule_fix/             # Сервис расписания
│   ├── app/
│   │   ├── main.py          # FastAPI приложение
│   │   ├── models/          # Модели данных
│   │   ├── services/        # Бизнес-логика
│   │   └── utils/           # Утилиты
│   └── Dockerfile
├── utils/                    # Утилиты
│   ├── keyboard.py          # Генерация клавиатур
│   ├── schedule_image.py    # Генерация изображений расписания
│   └── states.py            # Управление состояниями
└── requirements.txt         # Python зависимости
```

## API документация

### Backend API

После запуска доступна Swagger документация:
- **Локально**: `https://localhost/api/docs`
- **Production**: `https://178.72.139.15.nip.io/api/docs`

## Лицензия

См. файл [LICENSE](LICENSE)

## Авторы
Пархоменко Георгий Дмитриевич
Чугунова Дарья Игоревна
Проект разработан для хакатона MAX-VK-Hack.

## Поддержка

При возникновении проблем:
1. Проверьте логи контейнеров: `docker compose logs`
2. Проверьте подключение к базе данных
3. Убедитесь, что все переменные окружения установлены
4. Проверьте, что порты не заняты другими приложениями

